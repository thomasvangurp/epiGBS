===================
RnBeads (automated)
===================

Automated statistical analysis package for DNA methylation data with the use of RnBeads.
----------------------------------------------------------------------------------------

What it does
============

RnBeads is a great statistical R package that makes it possible to analyse DNA methylation data and visualize it in an very intuitive way. Visit the RnBeads website for all the information you need: http://rnbeads.mpi-inf.mpg.de/.
RnBeads requires some R programming background knowledge that not everybody has. Also, adding a genome requires quite some time and if you're not working with the human, rat or mouse genome, you need to take some steps for adding your own genome.

the rnbeads_new_genome.py script makes it possible to run a RnBeads analysis with a non-existing RnBeads genome, fully automated, with only four input files:

- The genome file (.fasta):
- Sample file (.csv):
- Annotation file (.txt):
- Methylation data file(.bed)

File formats
------------

**The genome file:**

Ordinary .fasta format, although, every numeric chromosome has to start with chr, e.g. chr1, chr10, chrx, chry. 
Also, "N" nucleotides in the .fasta file are allowed. 

**The sample file:**

RnBeads requires a sample file. The sample file consists of a comma separated values (csv). The first two columns in the file`s header are required:

- sampleID 
- filename_bed

the other header column names can only contain [a-z][A-Z] values, separated by underscores ( _ ). 
The second column value is **always** the first column value +.bed. The sample rows may contain numeric values as well

Example: 

sampleID,filename_bed,treatment,offspring,self_control 
                                                       
sample1,sample1.bed,water,x,self                       
                                                       
sample2,sample2.bed,nothing,y,control                  

**The Annotation file:**

The annotation file consist out of a plain .txt file with each cluster to be analysed separated by a newline (\\n). The names have to correspond to the given .fasta names!

for example: (without whitespaces)

chr1 \\n
chr2 \\n
chr3 \\n
chr4

If you're working with normal chromosomes instead of clusters, the format of the file will be slightly different: (without whitespaces)

chr1 \\t 100 \\t 150 \\n

chr1 \\t 200 \\t 300 \\n

chr2 \\t 100 \\t 150 \\n

Where the first column is the chromosome, the second the start position of the annotation and the thirt the end position. All columns are separated by tabs and rows by newlines. 

**The methylation data file:**

This file is of .bed format. The output is generated by out own methylation calling software but is also reproducible. All values are separated by a tab (\\t). The format of the file contains the following: 

**Header:** (samples_called = total number of samples at a specific position where there are reads found)

chr (\\t) pos (\\t) context (\\t) samples_called (\\t) sample_1_methylated (\\t) sample_1_total (\\t) sample_2_methylated (\\t) sample_2_total 

**Rows:** (samples that have no reads will contain "None" values) 

chr1 (\\t) 2 (\\t) CG (\\t) 2 (\\t) 5 (\\t) 20 (\\t) 10 (\\t) 21

chr1 (\\t) 10 (\\t) CHG (\\t) 1 (\\t) 31 (\\t) 50 (\\t) None (\\t) None

It's also possible to generate your data with our software package... see methyl_call.py

How it works
============

**Parameters:**
---------------

**-f, --fasta :** Fasta input file of the new genome.

**-b, --bed :** Bed input file to be analysis. 

**-a, --annotation :** Annotation file for specific chromosomes to be analysed. Extra files can be added by separating the values with a whitespace. The name of the file name will be the name of the annotation and may only consist out of [a-z][A-Z][0-9] values. 

**-sf, --sample_file :** Sample file 

**-tmp, --temp_directory :** Temporary directory where the files will be saved (they will be deleted after the analysis) 

**-template, --template_directory :** Directory of the templates (named templates in this repository)

**-s, --species_name :** Name of the species, belonging to the genome (Latin)

**-g, --genus_name :** Name of the genus from where the organism stems from (Latin) 

**-v, --version :** Version of the genome (By default: 1) 

**-ac, --assembly_code :** Assembly code of the organism (format: [a-z][0-9])

**-o, --output :** Output file, only used in combination with the Galaxy wrapper

**-lp, --lib_path :** Library installation folder for the R packages (optional).

**-c, --cores :** Number of cores you want to use for the analysis. (default=2)

Example:
--------

python rnbeads_analysis.py add_and_analysis -f /path/to/my/fasta.fa -b /path/to/my/file.bed -a /path/to/my/annotation.txt -sf /path/to/sample.csv -tmp /tmp/ -template /path/to/RnBeads/templates/ -s Homo -g sapiens -v 1 -ac hs1 -lp /path/to/R/packages/ -c 8
 

